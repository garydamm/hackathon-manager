# Progress Log

## Learnings
- When adding a new required field to an entity (like `createdBy`), ALL test files that construct that entity must be updated — not just the ones for the feature being changed. Search broadly with `= Project(` across all test files.
- Making an entity field nullable (e.g., `team: Team` → `team: Team?`) requires updating every access site to use `?.` or `!!.`. Use `replace_all` where appropriate.
- Hibernate `ddl-auto: validate` in repository tests (via TestContainers) means entity changes MUST align with migration changes — they can't be separated into different PRD tasks if the tests need to pass.
- Use `:test` (with project qualifier) to avoid mcp-server subproject failing when filtering tests.

---

## Iteration 1 - US-001: Database migration to decouple projects from teams
- Created V8__decouple_projects_from_teams.sql migration:
  - Makes team_id nullable, adds created_by column with FK to users
  - Backfills created_by from teams.created_by before adding NOT NULL constraint
  - Replaces partial unique index to include `WHERE team_id IS NOT NULL AND archived_at IS NULL`
  - Adds indexes on created_by and (hackathon_id, created_by)
- Updated Project entity: `team: Team` → `team: Team? = null`, added `createdBy: User` ManyToOne
- Updated ProjectDtos: `teamId: UUID` → `UUID?`, `teamName: String` → `String?`, safe-null access in fromEntity()
- Updated CreateProjectRequest: `teamId: UUID` → `UUID?`, added `hackathonId: UUID?`
- Updated ProjectService.createProject: handles nullable teamId, passes createdBy from team.createdBy
- Updated ProjectService (update/submit/unsubmit/archive): `project.team.id!!` → `project.team!!.id!!`
- Updated LeaderboardService: same `!!` pattern for team access
- Updated ALL test files constructing Project entities to include `createdBy = testUser`:
  - ProjectRepositoryTest, ProjectServiceTest, ProjectControllerTest
  - ScoringServiceTest, LeaderboardServiceTest, JudgeManagementServiceTest
  - JudgeAssignmentRepositoryTest, ScoreRepositoryTest
- Files changed:
  - src/main/resources/db/migration/V8__decouple_projects_from_teams.sql (new)
  - src/main/kotlin/com/hackathon/manager/entity/Project.kt
  - src/main/kotlin/com/hackathon/manager/dto/ProjectDtos.kt
  - src/main/kotlin/com/hackathon/manager/service/ProjectService.kt
  - src/main/kotlin/com/hackathon/manager/service/LeaderboardService.kt
  - 7 test files updated for createdBy parameter
- Learnings for future iterations:
  - Entity changes ripple broadly — always grep for constructor usage across ALL tests
  - The `team!!.id!!` pattern is temporary — US-003 will properly handle null-team authorization
---
