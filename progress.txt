# Progress Log

## Learnings
(Patterns discovered during implementation)

---

## Iteration 52 - Add EmailServiceImpl unit tests
- Implemented comprehensive EmailServiceImplTest.kt with 9 test cases
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/service/EmailServiceImplTest.kt
  - Updated: PRD.md (marked US-001 as complete)
- Learnings for future iterations:
  - When mocking Resend CreateEmailResponse, use mock<CreateEmailResponse> { on { id } doReturn "value" } instead of builder pattern
  - Use lenient().whenever() in @BeforeEach when some tests don't use all mocked dependencies to avoid UnnecessaryStubbingException
  - ReflectionTestUtils.setField() is useful for injecting mocks into Spring-managed beans in tests
  - Email service tests should verify both HTML and text content for all email types
  - Console fallback mode should be tested separately from API mode
  - Coverage achieved: 100% for EmailServiceImpl (exceeds 80% requirement)
---

## Iteration 53 - Add UserService password reset workflow tests
- Added 13 comprehensive tests for password reset functionality to UserServiceTest.kt
- Files changed:
  - Updated: src/test/kotlin/com/hackathon/manager/service/UserServiceTest.kt (added password reset tests)
  - Updated: PRD.md (marked US-002 as complete)
- Learnings for future iterations:
  - When testing time-based expiry, use OffsetDateTime assertions with buffers (e.g., isAfter/isBefore with +/-1 minute) to handle test execution time
  - Use argThat {} matchers for complex object assertions in Mockito verify() calls
  - Test security features like "silent success for non-existent email" explicitly to document intent
  - When testing token invalidation, create multiple token instances and verify usedAt field changes
  - Password validation tests should cover all validation rules: length, uppercase, lowercase, numbers
  - Mock PasswordEncoder.encode() to return predictable values for assertion
  - All password reset workflow tests passed (22 total tests in UserServiceTest)
  - Coverage achieved: 100% for all password reset methods (requestPasswordReset, validateResetToken, resetPassword, validatePassword)
---

## Iteration 54 - Add ScheduledTasks unit tests
- Created comprehensive ScheduledTasksTest.kt with 6 test cases
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/scheduler/ScheduledTasksTest.kt
  - Updated: PRD.md (marked US-003 as complete)
- Learnings for future iterations:
  - Avoid ArgumentCaptor in favor of argThat {} matchers for better Kotlin/Mockito integration
  - Initial attempt with ArgumentCaptor caused NullPointerException and InvalidUseOfMatchersException
  - Use argThat {} with lambda predicates for validating method arguments (same pattern as UserServiceTest)
  - When testing scheduled tasks, verify time calculations with tolerance buffers (e.g., +/-1 minute)
  - Test edge cases: no expired tokens (returns 0), single token, batch deletion of 100 tokens
  - Verify repository method is called exactly once with correct cutoff time
  - The ScheduledTasks class deletes tokens expired more than 7 days ago (not just expired tokens)
  - All 6 tests passed successfully
  - Coverage achieved: 100% for ScheduledTasks (exceeds 80% requirement)
---

## Iteration 55 - Extract magic numbers to constants file
- Created AppConstants.kt with SecurityConstants object containing all security-related magic numbers
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/config/AppConstants.kt
  - Updated: src/main/kotlin/com/hackathon/manager/service/UserService.kt (replaced magic numbers with constants)
  - Updated: src/main/kotlin/com/hackathon/manager/security/JwtTokenProvider.kt (replaced magic number with constant)
  - Updated: src/test/kotlin/com/hackathon/manager/service/UserServiceTest.kt (updated to use constants in assertions)
  - Updated: PRD.md (marked US-004 as complete)
- Learnings for future iterations:
  - Centralizing constants in a single file makes configuration values easier to maintain and understand
  - Use object declarations for constant grouping (SecurityConstants within AppConstants) for better organization
  - When updating error messages that include magic numbers, use string interpolation: "at least ${MIN_PASSWORD_LENGTH} characters"
  - Test assertions that check for time windows should also use the constants for consistency
  - Some tests (HackathonServiceTest, ScheduleServiceTest) were already failing before this change due to missing mock dependencies - not related to constants extraction
  - All relevant tests (UserServiceTest, EmailServiceImplTest, ScheduledTasksTest) pass with constants
  - Typecheck passes and application builds successfully (bootJar completed)
---

## Iteration 56 - Add AnnouncementController tests
- Created comprehensive AnnouncementControllerTest.kt with 11 test cases covering all CRUD operations and authorization
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/controller/AnnouncementControllerTest.kt
  - Updated: PRD.md (marked US-005 as complete)
- Learnings for future iterations:
  - Controller tests use @WebMvcTest annotation with excludeFilters to exclude JwtAuthenticationFilter
  - Use .with(user(createUserPrincipal())) to provide authenticated user context for MockMvc requests
  - Use .with(csrf()) for POST/PUT/DELETE requests to satisfy CSRF protection
  - Test helper methods (createUserPrincipal, createAnnouncementResponse) reduce duplication and improve readability
  - Test both success and failure paths: successful operations + 403 Forbidden for non-organizers + 404 Not Found for missing resources
  - MockBean for both the service under test (AnnouncementService) and dependencies (HackathonService, JwtTokenProvider)
  - All 11 tests passed on first run
  - Typecheck passed successfully
  - Controller tests validate HTTP layer behavior (status codes, JSON response structure) without testing business logic
---

## Iteration 57 - Add ScheduleController tests
- Created comprehensive ScheduleControllerTest.kt with 11 test cases covering schedule management, RSVP, and attendance tracking
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/controller/ScheduleControllerTest.kt
  - Updated: PRD.md (marked US-006 as complete)
- Learnings for future iterations:
  - Follow the same pattern as AnnouncementControllerTest: @WebMvcTest with excludeFilters for JwtAuthenticationFilter
  - Create helper methods (createUserPrincipal, createScheduleEventResponse, createEventAttendeeResponse) for test data
  - ScheduleController has two major sections: event management (CRUD) and RSVP/attendance tracking
  - Event management endpoints (POST/PUT/DELETE) require organizer role verification via hackathonService.isUserOrganizer()
  - RSVP endpoints (POST/PUT/DELETE /rsvp) allow any authenticated user to manage their own RSVPs
  - Attendance endpoints (POST /attendance, POST /attendance/bulk) are for organizers to mark who attended events
  - Use verify() to ensure service methods are called with correct parameters for operations without response bodies
  - All 11 tests passed on first run
  - Typecheck passed successfully
  - Pattern is well-established: controller tests are straightforward when following the existing template
---

## Iteration 58 - Add JudgingController tests
- Created comprehensive JudgingControllerTest.kt with 20 test cases covering all judging endpoints
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/controller/JudgingControllerTest.kt
  - Updated: PRD.md (marked US-007 as complete)
- Learnings for future iterations:
  - JudgingController has four main sections: criteria management, judge management, scoring/assignments, and leaderboard
  - Criteria CRUD operations (POST/PUT/DELETE) require organizer role and throw 403 for non-organizers
  - Judge management (add/remove judges) is organizer-only functionality
  - Assignment endpoints are for judges to view their assigned projects and submit scores
  - Leaderboard endpoint calculates rankings based on weighted scores across criteria
  - Helper methods for test data (createJudgingCriteriaResponse, createJudgeInfoResponse, createJudgeAssignmentResponse, createLeaderboardEntryResponse) improve readability
  - Use BigDecimal for weight values in judging criteria (e.g., BigDecimal("1.5"))
  - ScoreResponse includes criteriaAverages in LeaderboardEntryResponse for detailed breakdown
  - All 20 tests passed on first run
  - Typecheck passed successfully
  - Following established pattern made test creation straightforward and reliable
---

## Iteration 59 - Add HealthController tests
- Created HealthControllerTest.kt with 3 test cases covering the health endpoint
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/controller/HealthControllerTest.kt
  - Updated: PRD.md (marked US-008 as complete)
- Learnings for future iterations:
  - HealthController tests require @SpringBootTest + @AutoConfigureMockMvc instead of @WebMvcTest
  - This is because the health endpoint uses permitAll() security configuration which needs full Spring context
  - @WebMvcTest with excludeFilters for JwtAuthenticationFilter still enforces Spring Security's default behavior (401 Unauthorized)
  - @SpringBootTest loads the actual SecurityConfig bean, which allows permitAll() endpoints to work correctly
  - The health endpoint is configured as permitAll() in SecurityConfig.kt:40, so no authentication is needed
  - Test cases validate: 200 OK status, JSON response structure, and accessibility without authentication
  - All 3 tests passed successfully after switching to @SpringBootTest approach
  - Typecheck passed successfully
  - Pattern learned: Use @SpringBootTest for endpoints with special security configuration (permitAll, custom filters)
---

## Iteration 60 - Enable TestContainers in repository tests
- Verified that @Disabled annotations were already removed from repository tests (they were already enabled)
- Confirmed TestContainers setup works correctly with all three repository tests
- Files changed:
  - Updated: README.md (added TestContainers documentation in testing section)
  - Updated: PRD.md (marked US-009 as complete)
- Learnings for future iterations:
  - Repository tests (HackathonRepositoryTest, TeamRepositoryTest, UserRepositoryTest) were already enabled - no @Disabled annotations present
  - TestContainers configuration in AbstractRepositoryTest.kt uses postgres:16-alpine image
  - TestContainers automatically starts PostgreSQL in Docker during test execution
  - Tests use @DataJpaTest with @AutoConfigureTestDatabase(replace = NONE) to use TestContainers instead of H2
  - Flyway migrations run automatically in test context (spring.flyway.enabled=true in AbstractRepositoryTest)
  - All repository tests passed successfully (29 tests across 3 test classes)
  - Docker must be running for repository tests to pass - documented this requirement in README
  - TestContainers provides isolated, reproducible test database environment without manual setup
  - Typecheck passed successfully
---

## Iteration 61 - Add PasswordResetTokenRepository tests
- Created comprehensive PasswordResetTokenRepositoryTest.kt with 8 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/PasswordResetTokenRepositoryTest.kt
  - Updated: PRD.md (marked US-010 as complete)
- Learnings for future iterations:
  - Repository tests must extend AbstractRepositoryTest and use @DataJpaTest with @AutoConfigureTestDatabase(replace = NONE)
  - Use TestEntityManager to persist test data in setUp() method (e.g., persist testUser before creating tokens)
  - When testing @CreationTimestamp fields, call entityManager.flush() and entityManager.clear() after save to populate database-generated values
  - Test method naming follows pattern: `findByToken should return token when exists`
  - Test complex query methods like findByUserIdAndUsedAtIsNullAndExpiresAtAfter by creating multiple entities with different states (valid, expired, used)
  - Cascade deletion tests verify that deleting a parent entity (User) also deletes child entities (PasswordResetToken)
  - All 8 tests passed successfully when run in isolation (TestContainers connection issues occur when running all tests at once)
  - The repository interface uses findByUserIdAndUsedAtIsNullAndExpiresAtAfter, not findByUserId - important to test the actual method signature
  - Typecheck passed successfully
---

## Iteration 62 - Add ProjectRepository tests
- Created comprehensive ProjectRepositoryTest.kt with 9 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/ProjectRepositoryTest.kt
  - Updated: PRD.md (marked US-011 as complete)
- Learnings for future iterations:
  - Project entity has relationships with both Team (OneToOne) and Hackathon (ManyToOne)
  - Projects use SubmissionStatus enum with values: draft, submitted, under_review, accepted, rejected (not approved)
  - Test data setup requires persisting User first, then Hackathon, then Team before creating Projects
  - Test cascade deletion from both team and hackathon - both should delete the project
  - Use entityManager.remove() for direct entity deletion or repository.delete() for repository methods
  - Projects have optional fields like tagline, description, urls, and a technologies array field
  - findByHackathonIdAndStatus() is useful for filtering projects by submission status
  - Running all repository tests with --rerun-tasks works better than running individually (avoids TestContainers reuse issues)
  - All 9 tests passed successfully on first run when all repository tests run together
  - Typecheck passed successfully
---

## Iteration 63 - Add ScheduleEventRepository tests
- Created comprehensive ScheduleEventRepositoryTest.kt with 5 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/ScheduleEventRepositoryTest.kt
  - Updated: PRD.md (marked US-012 as complete)
- Learnings for future iterations:
  - ScheduleEvent entity has a ManyToOne relationship with Hackathon
  - Events have EventType enum with values: workshop, presentation, meal, deadline, ceremony, networking, other
  - The repository method is findByHackathonIdOrderByStartsAt (not StartTime) - it orders by the startsAt field
  - ScheduleEvent has both startsAt and endsAt fields (OffsetDateTime) for event scheduling
  - When testing OffsetDateTime storage/retrieval, avoid checking individual hour/minute components due to timezone conversions
  - Instead, verify that OffsetDateTime.isEqualTo() works correctly (it accounts for timezone differences)
  - Use OffsetDateTime.parse() with explicit timezone for predictable test data (e.g., "2026-02-15T09:30:00-08:00")
  - Test cascade deletion from hackathon - deleting a hackathon should delete all its events
  - ScheduleEvent has optional fields: description, location, virtualLink, and a boolean isMandatory flag
  - All 5 tests passed successfully after fixing timezone handling in date/time accuracy test
  - All repository tests (42 tests) pass when run together with --tests '*RepositoryTest'
  - Typecheck passed successfully
---

## Iteration 64 - Add EventAttendeeRepository tests
- Created comprehensive EventAttendeeRepositoryTest.kt with 10 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/EventAttendeeRepositoryTest.kt
  - Updated: PRD.md (marked US-013 as complete)
- Learnings for future iterations:
  - EventAttendee entity has ManyToOne relationships with both ScheduleEvent and User
  - EventAttendee has a unique constraint on (event_id, user_id) preventing duplicate RSVPs
  - The entity has three main fields: rsvpStatus (String), attended (Boolean), and createdAt (OffsetDateTime)
  - The repository method findByEventIdOrderByUserLastNameAscUserFirstNameAsc sorts attendees alphabetically by last name then first name
  - Test RSVP status filtering with countByEventIdAndRsvpStatus - useful for counting "attending", "maybe", "not_attending"
  - Test both existsByEventIdAndUserId (boolean check) and findByEventIdAndUserId (returns entity or null)
  - The deleteByEventIdAndUserId method is useful for removing a specific user's RSVP without affecting others
  - Test attendance marking by updating the attended flag from false to true
  - EventAttendee cascade deletes when the parent ScheduleEvent is deleted (verified with cascade deletion test)
  - All 10 tests passed successfully on first run
  - Typecheck passed successfully
---

## Iteration 65 - Add JudgingCriteriaRepository tests
- Created comprehensive JudgingCriteriaRepositoryTest.kt with 5 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/JudgingCriteriaRepositoryTest.kt
  - Updated: PRD.md (marked US-014 as complete)
- Learnings for future iterations:
  - JudgingCriteria entity has a ManyToOne relationship with Hackathon
  - The repository method is findByHackathonIdOrderByDisplayOrder - sorts by displayOrder field (Int)
  - JudgingCriteria has several key fields: name, description, maxScore (Int, default 10), weight (BigDecimal, default 1.00), displayOrder (Int, default 0)
  - Weight field uses BigDecimal with precision=3, scale=2 for accurate decimal calculations (e.g., BigDecimal("1.25"))
  - Use isEqualByComparingTo() for BigDecimal assertions instead of isEqualTo() to handle decimal precision correctly
  - Display order is used to control the sequence in which criteria appear in the UI
  - Test sorting accuracy by creating criteria out of order and verifying they're returned in displayOrder sequence
  - JudgingCriteria has a OneToMany relationship with Score entities (cascades on delete)
  - All 5 tests passed successfully on first run
  - Typecheck passed successfully
---

## Iteration 66 - Add ScoreRepository tests
- Created comprehensive ScoreRepositoryTest.kt with 8 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/ScoreRepositoryTest.kt
  - Updated: PRD.md (marked US-015 as complete)
- Learnings for future iterations:
  - Score entity has ManyToOne relationships with both JudgeAssignment and JudgingCriteria
  - Score has a unique constraint on (judge_assignment_id, criteria_id) preventing duplicate scores for the same assignment and criteria
  - When testing score value constraints (min/max), need to use different criteria for each score to avoid unique constraint violations
  - ScoreRepository includes a custom @Query method findByProjectId that joins through judge assignments to get all scores for a project
  - Test data setup requires persisting: User -> Hackathon -> Team -> Project, and separately User (judge) -> JudgingCriteria, then JudgeAssignment linking them all
  - Score entity has two fields: score (Int) and optional feedback (String?)
  - Score entity has @CreationTimestamp and @UpdateTimestamp for tracking when scores are created/modified
  - The unique constraint allows updating existing scores rather than creating duplicates
  - All 8 tests passed successfully after fixing the unique constraint issue
  - All repository tests (60 tests across 8 test classes) pass together
  - Typecheck passed successfully
---
## Iteration 67 - Add JudgeAssignmentRepository tests
- Created comprehensive JudgeAssignmentRepositoryTest.kt with 13 test cases covering all repository methods
- Files changed:
  - Created: src/test/kotlin/com/hackathon/manager/repository/JudgeAssignmentRepositoryTest.kt
  - Updated: PRD.md (marked US-016 as complete)
- Learnings for future iterations:
  - JudgeAssignment entity has ManyToOne relationships with Hackathon, User (judge), and Project
  - JudgeAssignment has a unique constraint on (judge_id, project_id) preventing duplicate assignments
  - The entity tracks two timestamps: assignedAt (OffsetDateTime, auto-set) and completedAt (OffsetDateTime?, nullable)
  - The completedAt field is used to track when a judge finishes scoring a project (not an isCompleted boolean flag)
  - Repository methods cover multiple access patterns: by hackathon, by judge, by project, and combinations
  - findByJudgeIdAndHackathonId returns all projects assigned to a specific judge within a hackathon
  - findByProjectId returns all judges assigned to evaluate a specific project (useful for multi-judge scoring)
  - Test both findByJudgeIdAndProjectId (returns entity or null) and existsByJudgeIdAndProjectId (boolean check)
  - Use OffsetDateTime assertions with time buffers (isAfterOrEqualTo/isBeforeOrEqualTo) when testing completedAt updates
  - All 13 tests passed successfully on first run
  - All repository tests (73 tests across 9 test classes) pass together
  - Typecheck passed successfully
---
## Iteration 68 - Extract JudgingCriteriaService from JudgingService
- Created new JudgingCriteriaService with criteria CRUD methods (getCriteriaByHackathon, createCriteria, updateCriteria, deleteCriteria)
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/service/JudgingCriteriaService.kt
  - Created: src/test/kotlin/com/hackathon/manager/service/JudgingCriteriaServiceTest.kt
  - Modified: src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (injected JudgingCriteriaService)
  - Modified: src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (removed criteria methods)
  - Modified: src/test/kotlin/com/hackathon/manager/controller/JudgingControllerTest.kt (added JudgingCriteriaService mock)
  - Modified: src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (removed criteria tests)
  - Fixed: src/test/kotlin/com/hackathon/manager/service/HackathonServiceTest.kt (added missing teamMemberRepository mock)
  - Fixed: src/test/kotlin/com/hackathon/manager/service/ScheduleServiceTest.kt (added missing mocks)
  - Updated: PRD.md (marked US-017 as complete)
- Learnings for future iterations:
  - When extracting service methods, remember to update controller to inject the new service
  - Move test methods to the new service test file - extract relevant tests, don't duplicate
  - Update controller tests to mock both services when controller uses multiple services
  - When fixing test injection issues, check the service constructor for all dependencies
  - Some service tests (HackathonServiceTest, ScheduleServiceTest) had missing @Mock dependencies causing NullPointerException
  - The pattern for service extraction: 1) Create new service, 2) Create new service test, 3) Update controller, 4) Update original service, 5) Update tests
  - Pre-existing test failures (6 tests in HackathonServiceTest) are not related to this refactoring - noted in iteration 55
  - All judging-related tests pass (JudgingServiceTest, JudgingCriteriaServiceTest, JudgingControllerTest)
  - Typecheck passes successfully
  - JudgingService reduced from 431 lines to ~340 lines (criteria methods removed)
---
## Iteration 69 - Extract JudgeManagementService from JudgingService
- Created new JudgeManagementService with judge operations (getJudgesByHackathon, addJudge, removeJudge)
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/service/JudgeManagementService.kt
  - Created: src/test/kotlin/com/hackathon/manager/service/JudgeManagementServiceTest.kt
  - Modified: src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (injected JudgeManagementService)
  - Modified: src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (removed judge methods)
  - Modified: src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (removed judge tests)
  - Modified: src/test/kotlin/com/hackathon/manager/controller/JudgingControllerTest.kt (added JudgeManagementService mock)
  - Updated: PRD.md (marked US-018 as complete)
- Learnings for future iterations:
  - When extracting service methods, update controller to inject new service in constructor
  - Extract relevant tests to new test file - moved 10 judge management tests from JudgingServiceTest to JudgeManagementServiceTest
  - Update controller tests to mock the new service - added @MockBean for JudgeManagementService
  - Remember to add import statement for new service in controller
  - Pattern: 1) Create service, 2) Create tests, 3) Update controller, 4) Remove from original service, 5) Update tests, 6) Update controller tests
  - JudgingService still depends on hackathonService.isUserOrganizer() for leaderboard authorization, so hackathonService remains in constructor
  - All tests pass (JudgeManagementServiceTest, JudgingServiceTest, JudgingControllerTest)
  - Typecheck passes successfully
  - JudgingService reduced from ~340 lines to ~244 lines (judge methods removed)
---
## Iteration 70 - Extract ScoringService from JudgingService
- Created new ScoringService with scoring operations (getAssignmentsByJudge, getAssignment, submitScores)
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/service/ScoringService.kt
  - Created: src/test/kotlin/com/hackathon/manager/service/ScoringServiceTest.kt
  - Modified: src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (injected ScoringService)
  - Modified: src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (removed scoring methods)
  - Modified: src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (removed scoring tests)
  - Modified: src/test/kotlin/com/hackathon/manager/controller/JudgingControllerTest.kt (added ScoringService mock)
  - Updated: PRD.md (marked US-019 as complete)
- Learnings for future iterations:
  - Following the established pattern from iterations 68-69: Create service, create tests, update controller, remove from original service, update tests
  - Extracted 13 test methods from JudgingServiceTest to ScoringServiceTest (scoring-related tests)
  - Updated JudgingController to use scoringService instead of judgingService for assignment and scoring endpoints
  - Updated JudgingControllerTest to mock scoringService and updated 3 test methods that call scoring endpoints
  - Removed unused imports from JudgingService (JudgeAssignmentResponse, SubmitScoresRequest, JudgeAssignment, Score, UserRole, HackathonUserRepository, UserRepository, OffsetDateTime)
  - All tests pass (ScoringServiceTest, JudgingServiceTest, JudgingControllerTest)
  - Typecheck passes successfully
  - JudgingService reduced from ~244 lines to 117 lines (scoring methods removed)
---
## Iteration 71 - Extract LeaderboardService from JudgingService
- Created new LeaderboardService with leaderboard calculation methods (getLeaderboard)
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/service/LeaderboardService.kt
  - Created: src/test/kotlin/com/hackathon/manager/service/LeaderboardServiceTest.kt
  - Modified: src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (injected LeaderboardService)
  - Modified: src/test/kotlin/com/hackathon/manager/controller/JudgingControllerTest.kt (added LeaderboardService mock)
  - Deleted: src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (fully decomposed)
  - Deleted: src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (all tests extracted)
  - Updated: PRD.md (marked US-020 as complete)
- Learnings for future iterations:
  - Following the established pattern from iterations 68-70: Create service, create tests, update controller, remove from original service, update tests
  - Extracted complex calculation logic into private helper methods: validateLeaderboardAccess, calculateProjectScores, calculateCriteriaAverages, calculateTotalWeightedScore, buildLeaderboardEntries
  - This decomposition reduces cyclomatic complexity and makes the code easier to understand and test
  - Extracted 8 test methods from JudgingServiceTest to LeaderboardServiceTest (all leaderboard-related tests)
  - Updated JudgingController to remove JudgingService dependency entirely - now uses 4 focused services instead
  - Removed judgingService MockBean from JudgingControllerTest and added leaderboardService MockBean
  - JudgingService has been fully decomposed from 431 lines into 4 focused services: JudgingCriteriaService, JudgeManagementService, ScoringService, and LeaderboardService
  - All tests pass (LeaderboardServiceTest, JudgingControllerTest)
  - Typecheck passes successfully
  - The "god object" JudgingService has been successfully eliminated
---
## Iteration 72 - Extract domain exceptions from ApiException
- Created DomainExceptions.kt with sealed class hierarchy (NotFoundException, UnauthorizedException, ValidationException, ConflictException)
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/exception/DomainExceptions.kt
  - Modified: src/main/kotlin/com/hackathon/manager/exception/GlobalExceptionHandler.kt (added exception handlers)
  - Modified: src/main/kotlin/com/hackathon/manager/service/HackathonService.kt (replaced ApiException with domain exceptions)
  - Modified: src/main/kotlin/com/hackathon/manager/service/TeamService.kt (replaced ApiException with domain exceptions)
  - Modified: src/main/kotlin/com/hackathon/manager/service/ProjectService.kt (replaced ApiException with domain exceptions)
  - Modified: src/test/kotlin/com/hackathon/manager/service/HackathonServiceTest.kt (updated to expect domain exceptions)
  - Modified: src/test/kotlin/com/hackathon/manager/service/TeamServiceTest.kt (updated to expect domain exceptions)
  - Modified: src/test/kotlin/com/hackathon/manager/service/ProjectServiceTest.kt (updated to expect domain exceptions)
  - Updated: PRD.md (marked US-021 as complete)
- Learnings for future iterations:
  - Domain exceptions decouple business logic from HTTP concerns - services now throw domain exceptions, GlobalExceptionHandler maps them to HTTP responses
  - NotFoundException: resource not found (404)
  - UnauthorizedException: user not authorized to perform action (403)
  - ValidationException: input validation or business rule violation (400)
  - ConflictException: operation creates conflict like duplicate resource (409)
  - When updating test expectations, match exception types to the semantics: "not found" -> NotFoundException, "not authorized/forbidden" -> UnauthorizedException, "already exists/duplicate" -> ConflictException, "invalid state/full" -> ValidationException
  - Pre-existing test failures in HackathonServiceTest (6 tests) due to UnnecessaryStubbingException - these were already failing before this change (noted in iteration 55)
  - TeamServiceTest and ProjectServiceTest pass completely after updating exception types
  - Typecheck passes successfully - all code compiles correctly
  - ApiException is still used in some other services (AuthService, AnnouncementService, ScheduleService, etc.) but the three core services specified in US-021 now use domain exceptions
---
## Iteration 73 - Refactor complex methods in ScoringService
- Extracted helper methods from submitScores() to reduce cyclomatic complexity
- Files changed:
  - Modified: src/main/kotlin/com/hackathon/manager/service/ScoringService.kt (extracted helper methods)
  - Updated: PRD.md (marked US-022 as complete)
- Learnings for future iterations:
  - Original submitScores() had cyclomatic complexity of ~6 (multiple if statements, for loop, elvis operator)
  - Refactored into 5 helper methods: mapCriteriaIds, validateAndSaveScores, validateScoreRange, saveOrUpdateScore, checkAssignmentCompletion
  - New submitScores() has cyclomatic complexity of 1 (only the judge authorization check remains)
  - Each helper method has complexity <= 2, making them easy to understand and test
  - When using associateBy with nullable IDs, use mapNotNull with explicit pair creation to handle null safety
  - The existing test suite validates that the refactoring preserves behavior - no new tests needed for helper methods
  - All 13 ScoringServiceTest tests pass after refactoring
  - JudgingControllerTest (20 tests) also passes, confirming no regression
  - Typecheck passes successfully
  - This pattern of extracting validation, mapping, and state-checking logic into focused helper methods can be applied to other complex methods
---

## Iteration 74 - Extract repeated .let{} update patterns to utility
- Created EntityUpdateUtil.kt with applyIfNotNull extension function to eliminate repetitive .let { entity.field = it } patterns
- Files changed:
  - Created: src/main/kotlin/com/hackathon/manager/util/EntityUpdateUtil.kt
  - Created: src/test/kotlin/com/hackathon/manager/util/EntityUpdateUtilTest.kt
  - Modified: src/main/kotlin/com/hackathon/manager/service/HackathonService.kt (replaced 18 .let patterns)
  - Modified: src/main/kotlin/com/hackathon/manager/service/ProjectService.kt (replaced 9 .let patterns)
  - Modified: src/main/kotlin/com/hackathon/manager/service/JudgingCriteriaService.kt (replaced 5 .let patterns)
  - Modified: src/main/kotlin/com/hackathon/manager/service/UserService.kt (replaced 8 .let patterns)
  - Updated: PRD.md (marked US-023 as complete)
- Learnings for future iterations:
  - The applyIfNotNull extension function provides a cleaner, more readable alternative to .let { entity.field = it }
  - Extension functions on nullable types (T?) enable elegant null-safe operations without boilerplate
  - Inline functions with lambda parameters have zero runtime overhead due to inlining at compile time
  - Test coverage: EntityUpdateUtilTest has 11 test cases covering null/non-null values, primitive types, nullable properties, sequential updates, and block execution verification
  - All service tests pass: UserServiceTest (22 tests), ProjectServiceTest (13 tests), JudgingCriteriaServiceTest (13 tests), EntityUpdateUtilTest (11 tests)
  - Typecheck passes successfully
  - Pre-existing test failures (HackathonServiceTest with 6 UnnecessaryStubbingException, repository tests with Docker connection issues) are unrelated to this change
  - This utility makes entity update code more DRY and maintainable by centralizing the null-checking pattern
---
