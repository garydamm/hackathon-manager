# Progress Log

## Learnings
(Patterns discovered during implementation)

---

## Iteration 16 - Create EventAttendeeRepository
- Created EventAttendeeRepository.kt extending JpaRepository
- Added methods: findByEventIdAndUserId, findByEventIdOrderByUserLastNameAscUserFirstNameAsc, existsByEventIdAndUserId, countByEventIdAndRsvpStatus, deleteByEventIdAndUserId
- Files changed:
  - src/main/kotlin/com/hackathon/manager/repository/EventAttendeeRepository.kt (created)
- Learnings for future iterations:
  - Repository pattern follows standard Spring Data JPA conventions
  - Method names follow query derivation pattern: findBy/existsBy/countBy/deleteBy + property combinations
  - EventAttendee entity already existed with proper relationships to ScheduleEvent and User
  - Repositories are simple interfaces - Spring generates implementation automatically
---

## Iteration 17 - Add EventAttendee DTOs
- Created EventAttendeeDtos.kt with all required DTOs
- Added EventAttendeeResponse with fromEntity() companion method that extracts user details from the EventAttendee entity
- Added RsvpRequest with @Pattern validation for rsvpStatus (attending|maybe|not_attending)
- Added MarkAttendanceRequest for single user attendance tracking
- Added BulkMarkAttendanceRequest for marking multiple users at once
- Files changed:
  - src/main/kotlin/com/hackathon/manager/dto/EventAttendeeDtos.kt (created)
  - PRD.md (marked US-002 complete)
- Learnings for future iterations:
  - DTO pattern follows existing codebase conventions with data classes and validation annotations
  - Response DTOs use companion object with fromEntity() factory method
  - Request DTOs use Jakarta validation annotations (@NotBlank, @NotNull, @Pattern)
  - @Pattern annotation validates enum-like string values for rsvpStatus
  - EventAttendeeResponse includes user details (firstName, lastName, email) by accessing attendee.user properties
---

## Iteration 18 - Update ScheduleEventResponse with RSVP data
- Updated ScheduleEventResponse data class to include RSVP and attendance fields
- Added 5 new fields: attendingCount, maybeCount, notAttendingCount, userRsvpStatus, userAttended
- Updated fromEntity() companion method signature to accept RSVP counts and optional EventAttendee
- Added EventAttendee import to ScheduleEventDtos.kt
- Files changed:
  - src/main/kotlin/com/hackathon/manager/dto/ScheduleEventDtos.kt
  - PRD.md (marked US-003 complete)
- Learnings for future iterations:
  - Response DTOs can be enhanced with additional optional parameters in fromEntity() to support different contexts
  - Default parameter values (= 0, = null) allow backwards compatibility when updating DTOs
  - RSVP counts are passed separately from the entity since they require aggregation queries
  - userAttendee parameter is nullable to support both authenticated and unauthenticated requests
---

## Iteration 19 - Add isUserRegistered helper to HackathonService
- Added isUserRegistered(hackathonId, userId) method to HackathonService
- Method uses hackathonUserRepository.existsByHackathonIdAndUserId() to return boolean
- Added @Transactional(readOnly = true) annotation following service layer pattern
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/HackathonService.kt
  - PRD.md (marked US-004 complete)
- Learnings for future iterations:
  - HackathonUserRepository already has existsByHackathonIdAndUserId() method
  - Helper methods in service layer should follow @Transactional(readOnly = true) pattern for read operations
  - isUserRegistered checks if user has ANY role in the hackathon (organizer, judge, admin, or participant)
  - This is useful for RSVP validation - any registered user can RSVP to events
---

## Iteration 20 - Add RSVP service methods to ScheduleService
- Injected eventAttendeeRepository, userRepository, and hackathonService into ScheduleService constructor
- Added getScheduleByHackathonWithRsvp(hackathonId, userId?) method that includes RSVP counts per event
- Added rsvpToEvent(eventId, userId, rsvpStatus) method that creates or updates RSVP with full validation
- Added removeRsvp(eventId, userId) method that deletes RSVP records
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/ScheduleService.kt
  - PRD.md (marked US-005 complete)
- Learnings for future iterations:
  - countByEventIdAndRsvpStatus returns Long, must convert to Int using .toInt() for ScheduleEventResponse
  - getScheduleByHackathonWithRsvp queries RSVP counts for each event and includes user's RSVP status if userId provided
  - rsvpToEvent validates: rsvpStatus enum, event exists, user exists, and user is registered for hackathon
  - When creating/updating RSVP, use findByEventIdAndUserId() first, create new EventAttendee if null
  - removeRsvp uses deleteByEventIdAndUserId() which is safe even if record doesn't exist
  - Service layer handles all business logic and validation before repository operations
---

## Iteration 21 - Add attendance tracking service methods
- Added three methods to ScheduleService for organizer-only attendance tracking
- Added getEventAttendees(eventId, requesterId) that returns sorted list of attendees with RSVP/attendance data
- Added markAttendance(eventId, userId, attended, requesterId) for marking single user attendance
- Added bulkMarkAttendance(eventId, userIds, attended, requesterId) for marking multiple users at once
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/ScheduleService.kt
  - PRD.md (marked US-006 complete)
- Learnings for future iterations:
  - Authorization pattern: validate entity exists first, then check isUserOrganizer() before any operations
  - All attendance methods throw ApiException with FORBIDDEN status if requester is not organizer
  - markAttendance and bulkMarkAttendance create EventAttendee records if they don't exist (similar to RSVP pattern)
  - getEventAttendees uses findByEventIdOrderByUserLastNameAscUserFirstNameAsc for alphabetical sorting
  - bulkMarkAttendance validates each userId exists before updating to provide specific error messages
  - EventAttendeeResponse.fromEntity() imported to return properly formatted attendee lists
---

## Iteration 22 - Add RSVP endpoints to ScheduleController
- Updated existing GET /schedule/hackathon/{hackathonId} to use getScheduleByHackathonWithRsvp()
- Added POST /schedule/{eventId}/rsvp endpoint that creates new RSVP and returns 201 CREATED
- Added PUT /schedule/{eventId}/rsvp endpoint that updates existing RSVP and returns 200 OK
- Added DELETE /schedule/{eventId}/rsvp endpoint that removes RSVP and returns 204 NO CONTENT
- Files changed:
  - src/main/kotlin/com/hackathon/manager/controller/ScheduleController.kt
  - PRD.md (marked US-007 complete)
- Learnings for future iterations:
  - GET endpoint accepts nullable @AuthenticationPrincipal to support both authenticated and unauthenticated requests
  - POST and PUT endpoints both call rsvpToEvent() service method (creates or updates)
  - All RSVP endpoints require authentication since they use @AuthenticationPrincipal principal (non-nullable)
  - RsvpRequest DTO includes validation, so @Valid annotation ensures proper validation
  - Service layer returns ScheduleEventResponse with updated RSVP counts for immediate UI feedback
  - DELETE endpoint uses noContent() for 204 status with no body
---

## Iteration 23 - Add attendance tracking endpoints
- Added three endpoints to ScheduleController for organizer attendance tracking
- Added GET /schedule/{eventId}/attendees that returns List<EventAttendeeResponse>
- Added POST /schedule/{eventId}/attendance with MarkAttendanceRequest body for single user
- Added POST /schedule/{eventId}/attendance/bulk with BulkMarkAttendanceRequest body for multiple users
- Files changed:
  - src/main/kotlin/com/hackathon/manager/controller/ScheduleController.kt
  - PRD.md (marked US-008 complete)
- Learnings for future iterations:
  - Service methods markAttendance and bulkMarkAttendance return Unit (void), not entities
  - POST endpoints for attendance return ResponseEntity<Void> with 200 OK status using .ok().build()
  - All three endpoints require authentication and pass principal.id to service layer for organizer check
  - Service layer handles all authorization validation (throws FORBIDDEN if not organizer)
  - GET attendees endpoint returns full list with user details, RSVP status, and attendance flag
  - Import statements needed: BulkMarkAttendanceRequest, EventAttendeeResponse, MarkAttendanceRequest
---

## Iteration 24 - Add TypeScript types for schedule and events
- Added all required TypeScript types to frontend/src/types/index.ts
- Added EventType union type with 7 event types: workshop, presentation, meal, deadline, ceremony, networking, other
- Added RsvpStatus union type with 3 statuses: attending, maybe, not_attending
- Added ScheduleEvent interface with all fields including RSVP counts and user-specific fields
- Added EventAttendee interface with user details, RSVP status, and attendance flag
- Added CreateScheduleEventRequest and UpdateScheduleEventRequest interfaces for event management
- Added RsvpRequest, MarkAttendanceRequest, and BulkMarkAttendanceRequest interfaces for RSVP and attendance operations
- Files changed:
  - frontend/src/types/index.ts
  - PRD.md (marked US-009 complete)
- Learnings for future iterations:
  - Frontend types should match backend DTO structure for consistency
  - Union types are preferred over enums in TypeScript for string literal types
  - All optional fields use `| null` for consistency with backend nullable types
  - Build command (`npm run build`) runs `tsc -b` which performs type checking
  - Request interfaces use optional fields for partial updates (UpdateScheduleEventRequest)
---

## Iteration 25 - Create schedule API service
- Created frontend/src/services/schedule.ts with all required methods
- Exported scheduleService singleton object with 11 methods
- Schedule retrieval: getSchedule(hackathonId), getEvent(eventId)
- Event management: createEvent, updateEvent, deleteEvent
- RSVP operations: rsvpToEvent, updateRsvp, removeRsvp
- Attendance tracking: getEventAttendees, markAttendance, bulkMarkAttendance
- Files changed:
  - frontend/src/services/schedule.ts (created)
  - PRD.md (marked US-010 complete)
- Learnings for future iterations:
  - Frontend service pattern uses singleton object exported from file
  - All methods use centralized api client from ./api for consistent error handling and auth
  - Method signatures follow pattern: async methodName(params): Promise<ResponseType>
  - DELETE endpoints return Promise<void> since they return 204 NO CONTENT
  - POST/PUT endpoints for mutations return the updated entity for immediate UI feedback
  - Import types from @/types for proper type safety
  - Service endpoints match backend controller paths exactly
---

## Iteration 26 - Create RsvpButton component
- Created frontend/src/components/RsvpButton.tsx with dropdown menu for RSVP operations
- Created frontend/src/components/ui/dropdown-menu.tsx using @radix-ui/react-dropdown-menu
- Installed @radix-ui/react-dropdown-menu package (53 new packages)
- RsvpButton shows "RSVP" button when no RSVP exists, or color-coded badge when user has RSVP'd
- Dropdown menu with 4 options: Attending (green Check icon), Maybe (yellow HelpCircle), Not Attending (gray X), Remove RSVP
- Uses useMutation for rsvpToEvent, updateRsvp, and removeRsvp operations
- Handles loading states with Loader2 spinner
- Invalidates schedule queries on success for immediate UI feedback
- Files changed:
  - frontend/src/components/RsvpButton.tsx (created)
  - frontend/src/components/ui/dropdown-menu.tsx (created)
  - frontend/package.json, frontend/package-lock.json (added dependency)
  - PRD.md (marked US-011 complete)
- Learnings for future iterations:
  - Dropdown menu pattern uses DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem from shadcn/ui
  - Button can be used as DropdownMenuTrigger with asChild prop
  - Badge component supports custom className for color-coding (bg-green-100 text-green-700, etc.)
  - useMutation pattern: define mutationFn, handle onSuccess with queryClient.invalidateQueries
  - Component differentiates between create (no userRsvpStatus) and update (has userRsvpStatus) operations
  - Loading state disables both trigger button and menu items (isPending check)
  - Remove RSVP option only shown when userRsvpStatus exists (conditional separator and menu item)
---

## Iteration 27 - Create Schedule page with timeline view
- Created frontend/src/pages/Schedule.tsx with complete timeline view functionality
- Component fetches hackathon by slug, then schedule by hackathonId using dependent queries
- Implemented groupEventsByDay() helper function to group events by formatted date string
- Created EventCard component showing name, description, type badge, time, location, virtual link, RSVP counts
- Added mandatory indicator (red badge with AlertCircle icon and "Required" text)
- Virtual link shown with Video icon, opens in new tab with noopener noreferrer
- Integrated RsvpButton component in each event card header
- Added "Back to Hackathon" link with ArrowLeft icon
- Implemented empty state with Calendar icon and helpful message
- Files changed:
  - frontend/src/pages/Schedule.tsx (created)
  - PRD.md (marked US-012 complete)
- Learnings for future iterations:
  - Page follows AppLayout pattern with max-w-4xl container
  - Dependent queries pattern: enable second query only when first query has data (enabled: !!hackathon?.id)
  - groupEventsByDay() uses reduce to create object with date string keys
  - toLocaleDateString() with full options creates readable date headers: "Monday, January 27, 2026"
  - toLocaleTimeString() for time formatting: "9:00 AM"
  - EventCard uses Card with CardHeader and CardContent following existing component patterns
  - Badge color coding follows pattern: bg-{color}-100 text-{color}-700 border-{color}-200
  - Event type mapping: workshop (purple), presentation (blue), meal (orange), deadline (red), ceremony (yellow), networking (green), other (gray)
  - RSVP count display: shows attending always, adds maybe/not attending counts conditionally if > 0
  - Virtual links should use target="_blank" rel="noopener noreferrer" for security
---

## Iteration 28 - Add schedule route to app
- Imported SchedulePage component in App.tsx
- Added route /hackathons/:slug/schedule as a protected route
- Route follows existing pattern with ProtectedRoute wrapper
- Files changed:
  - frontend/src/App.tsx
  - PRD.md (marked US-013 complete)
- Learnings for future iterations:
  - New routes should be added in logical order (schedule route goes between hackathon detail and teams routes)
  - All authenticated routes use ProtectedRoute wrapper component
  - Route path follows pattern: /hackathons/:slug/<feature>
  - Dev server starts successfully on available port (5176 in this case, as 5173-5175 were in use)
  - Import statements should be grouped with other page imports at the top
---

## Iteration 29 - Create EventFormModal component
- Created frontend/src/components/EventFormModal.tsx following CriteriaFormModal pattern
- Implemented React Hook Form with Zod validation for all event fields
- Added all required fields: name*, description, eventType dropdown, location, virtualLink (URL validation), startsAt*, endsAt* (datetime-local), isMandatory (Switch)
- Supports both create and edit modes detected via event prop
- Uses framer-motion for modal animations (backdrop and modal)
- Shows validation errors inline using react-hook-form errors
- Handles create/update mutations with loading states (Loader2 spinner)
- Invalidates schedule queries on success for immediate UI feedback
- Files changed:
  - frontend/src/components/EventFormModal.tsx (created)
  - PRD.md (marked US-014 complete)
- Learnings for future iterations:
  - EventFormModal follows exact same pattern as CriteriaFormModal (modal structure, animations, form handling)
  - Switch component requires watch() and setValue() pattern for controlled behavior with react-hook-form
  - datetime-local input type requires ISO string conversion: toISOString().slice(0, 16) for editing
  - Form submission converts datetime-local back to ISO: new Date(data.startsAt).toISOString()
  - CreateScheduleEventRequest includes hackathonId in the request body, not as separate parameter
  - Virtual link validation uses z.string().url().optional().or(z.literal("")) to allow empty string
  - Modal uses max-w-2xl for wider layout due to more fields, and max-h-[90vh] overflow-y-auto for scrolling
  - Event type dropdown uses native <select> with input styling classes for consistency
  - isMandatory uses Switch component with controlled behavior via watch/setValue pattern
---
