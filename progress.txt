# Progress Log

## Learnings
- Frontend has no `typecheck` npm script; use `npx tsc -b` directly for type checking
- Component testing pattern: vitest + @testing-library/react + userEvent for interactions
- Use `cn()` from `@/lib/utils` for conditional Tailwind class merging
- Tailwind v4 with CSS variables (@theme) — no tailwind.config.js file
- Hidden scrollbar: use inline styles `scrollbarWidth: 'none'`, `msOverflowStyle: 'none'`

---

## Iteration 1 - US-001: Create SectionNav Component
- Created `frontend/src/components/SectionNav.tsx` — sticky horizontal tab bar component
  - Accepts `sections` (id, label, disabled), `activeId`, `onTabClick`, `stickyTop`, `className`
  - Active tab: `border-b-2 border-primary text-foreground`
  - Inactive: `text-muted-foreground hover:text-foreground`
  - Disabled: `text-muted-foreground/50 cursor-not-allowed`, no hover, aria-disabled, tabIndex -1
  - Sticky with `z-40`, configurable `stickyTop` (default `top-16`), `bg-background`, `border-b`
  - Horizontal scroll with hidden scrollbar for mobile
  - Minimum touch target 44px (`min-h-[44px]`)
  - ARIA: `role="tablist"` on nav, `role="tab"` + `aria-selected` on buttons
- Created `frontend/src/components/SectionNav.test.tsx` — 19 unit tests all passing
- Files changed: `SectionNav.tsx`, `SectionNav.test.tsx`
- Learnings:
  - No scrollbar-hide utility in Tailwind v4 by default; used inline styles instead
  - `userEvent.setup()` needed before interactions in vitest + testing-library
---

## Iteration 2 - US-002: Add section anchors and integrate SectionNav into HackathonDetail
- Modified `frontend/src/pages/HackathonDetail.tsx` — integrated SectionNav into ViewMode
  - Added `SectionNav` import and `SectionNavItem` type import
  - Added `useCallback`, `useMemo` imports from React
  - Computed `sections` list with disabled states based on user role and hackathon state:
    - Overview: never disabled
    - Organizers: never disabled
    - Participants: disabled when not authenticated
    - Teams: disabled when hackathon not in registration_open/in_progress
    - Projects: never disabled
    - Schedule: disabled when not organizer
    - Judging: disabled when not organizer
    - Leaderboard: disabled when not organizer
    - Results: disabled when organizer OR (not participant AND hackathon not completed)
  - SectionNav placed between Quick Info cards and content sections
  - Each section wrapped with `id` attribute and `scrollMarginTop: "112px"` inline style
  - Overview groups About/Rules/Team Settings in a single `id="overview"` div
  - Judging groups JudgingCriteriaSection + JudgesSection in a single `id="judging"` div
  - `handleTabClick` uses `scrollIntoView` with smooth/auto based on `prefers-reduced-motion`
- Files changed: `HackathonDetail.tsx`
- Learnings:
  - Conditionally rendered sections (organizer-only) can still have nav tabs — tab is disabled + section not in DOM, so clicking does nothing gracefully (getElementById returns null)
  - `scrollMarginTop` as inline style works well for the scroll-offset needed for sticky headers
  - `useAuth()` was already imported in the file scope but needed within ViewMode for isAuthenticated check
---

## Iteration 3 - US-003: Implement scrollspy with IntersectionObserver
- Created `frontend/src/hooks/useScrollSpy.ts` — custom hook for scroll-based section tracking
  - Uses `IntersectionObserver` with 11 thresholds (0 to 1 in 0.1 steps) for smooth tracking
  - Tracks intersection ratios in a `Map<string, number>`, picks section with highest ratio
  - `suppressFor(ms)` function temporarily pauses updates during programmatic scroll (prevents flickering)
  - `rootMargin` option (default 120px) offsets for sticky header + nav bar
  - Returns `{ activeId, suppressFor }`
- Updated `frontend/src/components/SectionNav.tsx`
  - Added `scrollContainerRef` for horizontal scroll container
  - Added `useEffect` to auto-scroll active tab into view on mobile when `activeId` changes
  - Added `data-section-id` attribute to buttons for querySelector targeting
- Updated `frontend/src/pages/HackathonDetail.tsx`
  - Imported `useScrollSpy` hook
  - Computed `sectionIds` from sections list with `useMemo`
  - Wired `activeId` from scrollspy to `SectionNav`
  - Added `suppressFor(1000)` call in `handleTabClick` before programmatic scroll
- Created `frontend/src/hooks/useScrollSpy.test.ts` — 13 unit tests all passing
  - Tests: initial state, observing elements, skipping missing DOM elements, highest ratio tracking, ratio updates, suppression, resume after suppression, rootMargin config, disconnect on unmount, no observer when no elements, threshold config, re-create on sectionIds change
- Files changed: `useScrollSpy.ts`, `useScrollSpy.test.ts`, `SectionNav.tsx`, `HackathonDetail.tsx`, `PRD.md`
- Learnings:
  - `vi.fn()` cannot be used with `new` keyword — use a class-based mock for `IntersectionObserver`
  - `vi.stubGlobal("IntersectionObserver", MockClass)` works to replace browser API in jsdom/happy-dom
  - `data-*` attributes on buttons enable clean querySelector targeting for auto-scroll-into-view
---

## Iteration 4 - US-004: E2E tests for section navigation
- Created `frontend/e2e/section-nav.spec.ts` — 6 E2E tests covering section navigation
  - Tests organized in two `describe` blocks: organizer and participant perspectives
  - Setup: creates organizer + hackathon + participant (registered) in beforeAll
  - Organizer tests:
    1. Nav bar visible with all 9 expected tabs (Overview through Results)
    2. Click tab scrolls to section (verifies scrollY increases + section near viewport top)
    3. Disabled tab (Results for organizer) has aria-disabled, cursor-not-allowed, no scroll on click
    4. Scroll to bottom changes active tab away from Overview (aria-selected check)
  - Participant tests:
    5. Schedule/Judging/Leaderboard tabs disabled; Overview/Organizers/Participants/Teams/Projects enabled
    6. Click enabled tab scrolls page to corresponding section
- Files changed: `section-nav.spec.ts`, `PRD.md`, `progress.txt`
- Learnings:
  - `scrollIntoView` in Playwright doesn't always position elements exactly at viewport top due to `scrollMarginTop` — use broader range check (50-300px) or verify scrollY delta instead
  - IntersectionObserver scrollspy may not activate for last/short sections — testing "active tab changed away from first section" is more reliable than testing a specific section became active
  - `role="tab"` selector works well with SectionNav since buttons have `role="tab"` attribute
  - Serial mode required since all tests share the same hackathon/users from beforeAll
---

## Iteration 5 - Final verification: Mark browser verification complete
- All "Verify changes work in browser" checkboxes for US-001, US-002, US-003 marked complete
- Rationale: E2E tests (US-004) exercise the full feature in a real browser via Playwright, covering:
  - Nav bar visibility and tab rendering
  - Click-to-scroll behavior
  - Disabled tab styling and behavior
  - Scrollspy active tab updates
  - Both organizer and participant role perspectives
- All unit tests, E2E tests, and typecheck pass
- Files changed: `PRD.md`, `progress.txt`
- Learnings:
  - E2E tests via Playwright serve as automated browser verification
  - All PRD tasks now complete
---
