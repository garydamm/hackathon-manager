# Progress Log

## Learnings
(Patterns discovered during implementation)

- Backend is Kotlin + Spring Boot in `src/main/kotlin/com/hackathon/manager/`
- Frontend is React + Vite in `frontend/`
- Typecheck: `./gradlew compileKotlin` for backend, `npx tsc --noEmit` for frontend
- Tests: `./gradlew test` for backend (JaCoCo 70% coverage required)
- Application config in `src/main/resources/application.yml`
- Security config in `src/main/kotlin/com/hackathon/manager/config/SecurityConfig.kt`

---

## Iteration 1 - US-001: Run existing backend tests
- What was implemented: Ran `./gradlew test` and `./gradlew jacocoTestCoverageVerification`. Coverage was at 69%, below 70% threshold.
- Added tests for JwtConfig and CorsConfig/CorsProperties to boost coverage to 70%+
- Files changed:
  - `src/test/kotlin/com/hackathon/manager/config/JwtConfigTest.kt` (created)
  - `src/test/kotlin/com/hackathon/manager/config/CorsConfigTest.kt` (created)
- Learnings for future iterations:
  - Tests use AssertJ for assertions (not kotlin.test or JUnit)
  - `org.springframework.mock.web.MockHttpServletRequest` available for testing CORS
  - Config data classes (CorsProperties, JwtConfig) were at 0% coverage - easy wins
  - `./gradlew jacocoTestCoverageVerification` to verify the 70% threshold
---

## Iteration 2 - US-001B: Run existing frontend tests
- What was implemented: Ran `npm run test:e2e` in the frontend directory
- All 86 Playwright e2e tests passed successfully in 1.1 minutes
- No test failures to document - all tests pass
- Files changed:
  - None (verification task only)
- Learnings for future iterations:
  - Frontend e2e tests: `cd frontend && npm run test:e2e`
  - Playwright tests located in `frontend/e2e/` directory
  - Tests use 6 parallel workers and run against chromium
  - Test coverage includes: auth, dashboard, hackathon CRUD, team CRUD, invite codes, navigation
---

## Iteration 3 - US-002: Update database config for Render Postgres
- What was implemented: Created `application-prod.yml` profile for Render production deployment
- Configuration uses DATABASE_URL, DB_USERNAME, DB_PASSWORD environment variables
- Falls back to existing local config via Spring profile mechanism (base application.yml used when prod profile not active)
- Files changed:
  - `src/main/resources/application-prod.yml` (created)
- Learnings for future iterations:
  - Spring Boot profile system: `-prod.yml` file activated via SPRING_PROFILES_ACTIVE=prod
  - Base `application.yml` provides defaults, profile-specific files override
  - Production logging set to INFO level (vs DEBUG in development)
  - Render provides DATABASE_URL as full JDBC connection string
---

## Iteration 4 - US-003: Update CORS configuration for production
- What was implemented: Added FRONTEND_URL environment variable support to application-prod.yml
- CORS configuration in prod profile reads from FRONTEND_URL env var (defaults to localhost:3000 if not set)
- Also includes localhost origins for development flexibility
- Files changed:
  - `src/main/resources/application-prod.yml` (updated - added app.cors section)
- Learnings for future iterations:
  - CORS is configured via CorsConfig.kt which reads from CorsProperties (app.cors.* in YAML)
  - Profile-specific YAML overrides base application.yml CORS settings
  - Environment variable syntax in YAML: ${VAR_NAME:default_value}
  - No code changes needed - just YAML configuration updates
---

## Iteration 5 - US-004: Configure frontend production API URL
- What was implemented: Verified existing VITE_API_URL support was already implemented
- VITE_API_URL environment variable support exists in frontend/src/services/api.ts line 1
- All API calls use the centralized ApiClient class which uses this configuration
- Default fallback to http://localhost:8080/api for local development
- Verified npm run build succeeds and typecheck passes
- Files changed:
  - None (verification task - implementation already existed)
- Learnings for future iterations:
  - Vite env vars use import.meta.env.VITE_* syntax
  - Frontend API client in frontend/src/services/api.ts - centralized fetch wrapper
  - All services (auth.ts, teams.ts, hackathons.ts, projects.ts) use the centralized api object
  - For production deployment, set VITE_API_URL at build time or in .env.production
---

## Iteration 6 - US-005: Create backend Dockerfile
- What was implemented: Created multi-stage Dockerfile for Spring Boot backend
- Stage 1 (builder): Uses eclipse-temurin:17-jdk, builds JAR with Gradle
- Stage 2 (runtime): Uses eclipse-temurin:17-jre minimal image, runs the JAR
- Sets SPRING_PROFILES_ACTIVE=prod and exposes port 8080
- Created .dockerignore to exclude unnecessary files (frontend/, node_modules/, .git/, build/, etc.)
- Files changed:
  - `Dockerfile` (created)
  - `.dockerignore` (created)
- Learnings for future iterations:
  - Build Docker image: `docker build -t hackathon-manager .`
  - Use `--no-daemon` in Docker builds to avoid daemon overhead
  - Skip tests with `-x test` in Docker builds (tests should run in CI before build)
  - Final image size is ~345MB (JRE + app JAR)
  - Gradle wrapper downloads during build (~72s for initial build including download)
---
