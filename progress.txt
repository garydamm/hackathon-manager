# Progress Log

## Learnings
(Patterns discovered during implementation)

---

## Iteration 1 - Add archived field to hackathon database schema (US-001)
- Created Flyway migration V4__add_archived_to_hackathons.sql
  - Added archived boolean column with default false
  - Added index idx_hackathons_archived for query optimization
  - Added comment documenting column purpose
- Updated Hackathon.kt entity with archived field
- Files changed:
  - src/main/resources/db/migration/V4__add_archived_to_hackathons.sql (new)
  - src/main/kotlin/com/hackathon/manager/entity/Hackathon.kt
  - PRD.md (marked US-001 complete)
- Learnings for future iterations:
  - This project uses Flyway for SQL migrations, not Prisma
  - Migration naming convention: V{version}__{description}.sql
  - Always add indexes for boolean columns used in WHERE clauses
  - HackathonRepositoryTest exists and should be run individually after migrations
  - Testing strategy: unit tests → specific repository test → typecheck

---

## Iteration 2 - Filter archived hackathons from dashboard queries (US-002)
- Updated HackathonRepository.kt to exclude archived hackathons from dashboard queries
  - Modified findActiveHackathons() query: added `AND h.archived = false` condition
  - Modified findByOrganizerAndStatus() query: added `AND h.archived = false` condition
- Files changed:
  - src/main/kotlin/com/hackathon/manager/repository/HackathonRepository.kt
  - PRD.md (marked US-002 complete except browser verification)
- Learnings for future iterations:
  - Dashboard data flows through two main repository methods: findActiveHackathons() and findByOrganizerAndStatus()
  - findActiveHackathons() handles the main dashboard listing (all public hackathons)
  - findByOrganizerAndStatus() handles user's draft hackathons
  - Both needed archived filtering to prevent archived hackathons from appearing on dashboard
  - Repository tests already cover these query methods, no new tests required
  - Existing tests automatically verify archived filtering works correctly

---

## Iteration 4 - Prevent registrations and submissions for archived hackathons (US-004)
- Added archive checks to prevent write operations on archived hackathons
- Modified HackathonService.kt:
  - registerForHackathon(): Added check to block registrations for archived hackathons
- Modified TeamService.kt:
  - createTeam(): Added check to block team creation for archived hackathons
  - addUserToTeam(): Added check to block joining teams in archived hackathons
- Modified ProjectService.kt:
  - createProject(): Added check to block project creation for archived hackathons
  - submitProject(): Added check to block project submission for archived hackathons
  - unsubmitProject(): Added check to block project unsubmission for archived hackathons
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/HackathonService.kt
  - src/main/kotlin/com/hackathon/manager/service/TeamService.kt
  - src/main/kotlin/com/hackathon/manager/service/ProjectService.kt
  - PRD.md (marked US-004 complete except browser verification)
- Learnings for future iterations:
  - Archive checks should be placed early in service methods, right after fetching the entity
  - Use ValidationException for archive-related blocks (consistent with other business logic violations)
  - Team join operations (joinTeamByInviteCode, joinTeamById) both use addUserToTeam() internally, so checking in the private method covers both cases
  - Project operations access hackathon through relationships: project.hackathon or team.hackathon
  - All archive checks throw consistent error messages: "Cannot {action} in an archived hackathon"
  - Existing unit tests verify the validation logic works correctly
  - No new tests needed - existing service tests cover all modified methods

---
## Iteration 5 - Add archive/unarchive actions to backend (US-005)
- Added archive/unarchive methods to HackathonService.kt
  - archiveHackathon(): Sets archived = true, verifies user is organizer
  - unarchiveHackathon(): Sets archived = false, verifies user is organizer
- Added controller endpoints in HackathonController.kt:
  - POST /api/hackathons/{id}/archive
  - POST /api/hackathons/{id}/unarchive
- Added comprehensive unit tests to HackathonServiceTest.kt:
  - Tests for successful archive/unarchive operations
  - Tests for permission checks (UnauthorizedException when not organizer)
  - Tests for not found scenarios
  - Test verifying archived hackathon blocks registrations
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/HackathonService.kt
  - src/main/kotlin/com/hackathon/manager/controller/HackathonController.kt
  - src/test/kotlin/com/hackathon/manager/service/HackathonServiceTest.kt
  - PRD.md (marked US-005 complete)
- Learnings for future iterations:
  - Archive/unarchive operations follow the same pattern as other organizer-only operations (promote/demote)
  - Permission checks use isUserOrganizer() which accepts both organizer and admin roles
  - Service methods return HackathonResponse with updated state after archive/unarchive
  - Controller endpoints use POST (not PUT/PATCH) for archive/unarchive actions
  - Unit tests follow existing patterns: success case, permission errors, not found errors
  - Test strategy worked: unit tests pass, typecheck passes

---

