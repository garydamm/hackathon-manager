# Progress Log

## Learnings
(Patterns discovered during implementation)

### Participant Count Implementation
- Participant counts are retrieved via `TeamMemberRepository.countDistinctUsersByHackathonId()`
- The query counts DISTINCT users in team_members table, not hackathon_users table
- This ensures only active participants (those who joined teams) are counted
- All service methods that return HackathonResponse must call `getParticipantCount()` to populate the count
- Methods that were missing participant counts: `getAllHackathons()`, `getActiveHackathons()`, `getUserDraftHackathons()`, `updateHackathon()`

### Testing Patterns
- Tests use Mockito with `@Mock` and `@InjectMocks` annotations
- Use `whenever().thenReturn()` to mock repository responses
- For methods that call participant count multiple times, use chained `.thenReturn()` calls
- Always verify repository methods were called with `verify()`
- Test both zero and non-zero participant counts

---

## Iteration 78 - Fix participant count query (US-001)
- Fixed getAllHackathons() to include participant counts by calling getParticipantCount()
- Fixed getActiveHackathons() to include participant counts
- Fixed getUserDraftHackathons() to include participant counts
- Fixed updateHackathon() to include participant counts in response
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/HackathonService.kt
  - src/test/kotlin/com/hackathon/manager/service/HackathonServiceTest.kt
  - PRD.md
- Learnings for future iterations:
  - The participant count query already existed and was correct (uses COUNT DISTINCT on team members)
  - The issue was that list endpoints (getAllHackathons, getActiveHackathons) weren't calling getParticipantCount()
  - Single hackathon endpoints (getHackathonById, getHackathonBySlug) already had participant counts
  - When adding mocks for teamMemberRepository in tests, need to update all existing tests that call the affected methods
  - Tests must mock the return value even when the actual value doesn't matter for that specific test assertion
---

## Iteration 79 - Create participant list query (US-002)
- Created ParticipantResponse DTO with name, email, registration date, team name, and leader flag
- Added TeamMemberRepository.findByHackathonId() query to fetch all team members for a hackathon
- Implemented HackathonService.getHackathonParticipants() that returns participants sorted alphabetically by name
- Added comprehensive unit tests covering sorting, empty lists, and error handling
- Files changed:
  - src/main/kotlin/com/hackathon/manager/dto/ParticipantDtos.kt (new)
  - src/main/kotlin/com/hackathon/manager/repository/TeamMemberRepository.kt
  - src/main/kotlin/com/hackathon/manager/service/HackathonService.kt
  - src/test/kotlin/com/hackathon/manager/service/HackathonServiceTest.kt
  - PRD.md
- Learnings for future iterations:
  - Participant data comes from TeamMember entities (users who joined teams)
  - TeamMember contains user, team, isLeader flag, and joinedAt timestamp
  - The service method uses .sortedBy { it.name } to sort alphabetically
  - ParticipantResponse.fromTeamMember() constructs full name from firstName + lastName
  - Tests should verify sorting order by using intentionally out-of-order test data
  - Need to import Team and TeamMember entities in test files when creating test data
---

## Iteration 80 - Display participant list on details page (US-003)
- Added GET /api/hackathons/{id}/participants endpoint to HackathonController (requires authentication)
- Created Participant type in frontend types (name, email, registrationDate, teamName, isLeader)
- Added getParticipants() method to hackathonService frontend service
- Created ParticipantsSection component that displays participants in a card format
- Added ParticipantsSection to HackathonDetail page (visible to all authenticated users)
- Created E2E test hackathon-participants-section.spec.ts covering display, count, details, and sorting
- Files changed:
  - src/main/kotlin/com/hackathon/manager/controller/HackathonController.kt
  - frontend/src/types/index.ts
  - frontend/src/services/hackathons.ts
  - frontend/src/components/ParticipantsSection.tsx (new)
  - frontend/src/pages/HackathonDetail.tsx
  - frontend/e2e/hackathon-participants-section.spec.ts (new)
  - PRD.md
- Learnings for future iterations:
  - Frontend components use React Query with useQuery for data fetching
  - The ParticipantsSection follows the same pattern as other sections (OrganizersSection, TeamsSection)
  - Components show loading state with Loader2 spinner while data is being fetched
  - Participant cards display name, email (as mailto link), registration date, team name, and leader badge
  - Team leader badge uses Shield icon with primary styling
  - This project uses Playwright for E2E tests, not unit tests for frontend components
  - E2E tests follow pattern: beforeAll setup, beforeEach login, individual test cases
  - Backend endpoint requires authentication via @AuthenticationPrincipal
---
## Iteration 81 - Verify participants section works in browser (US-003)
- Fixed E2E test to correctly create hackathons by adding required slug field
- Corrected team creation endpoint from /api/hackathons/{id}/teams to /api/teams
- Fixed property name mismatches between frontend and backend:
  * Backend sends isTeamLeader, frontend was expecting isLeader
  * Backend sends registeredAt, frontend was expecting registrationDate
- Updated frontend Participant type and ParticipantsSection component to match backend
- Improved E2E test selectors to avoid strict mode violations from ambiguous matches
- All 4 E2E tests now pass: section display, count, details, and sorting
- Files changed:
  - frontend/e2e/hackathon-participants-section.spec.ts
  - frontend/src/types/index.ts
  - frontend/src/components/ParticipantsSection.tsx
  - PRD.md
- Learnings for future iterations:
  - E2E tests revealed actual API contract issues that were missed during implementation
  - The backend CreateHackathonRequest requires a slug field (not auto-generated)
  - Team endpoints are at /api/teams with hackathonId in the body, not at /api/hackathons/{id}/teams
  - Frontend type definitions must match backend DTO property names exactly
  - When backend and frontend have property name mismatches, TypeScript won't catch it at compile time if the service returns `any` or uses generic type casting
  - Playwright strict mode violations occur when selectors match multiple elements - use .first(), .nth(), or more specific selectors
  - Testing vertical ordering of elements can be done by comparing boundingBox().y values
---
## Iteration 82 - Add empty state with registration CTA (US-004)
- Enhanced ParticipantsSection component to display improved empty state when no participants registered
- Added UserPlus icon from lucide-react for the registration button
- Empty state now shows:
  * Users icon in a muted circular background
  * "No participants registered yet" message
  * "Be the first to join this hackathon!" subtext
  * "Register Now" button with UserPlus icon (conditionally shown)
- Registration button only displays when:
  * Registration is open (status === "registration_open")
  * User is not already registered (userRole !== "participant")
  * onRegisterClick callback is provided
- Updated ParticipantsSection interface to accept hackathon and onRegisterClick props
- Modified HackathonDetail to pass hackathon object and onRegisterClick to ParticipantsSection
- Created comprehensive E2E test file: hackathon-participants-empty-state.spec.ts with 4 test cases:
  * Displays empty state message when no participants registered
  * Displays registration CTA button when user not registered and registration open
  * Does not display CTA when user is already registered
  * Empty state has appropriate styling consistent with app design
- Files changed:
  - frontend/src/components/ParticipantsSection.tsx
  - frontend/src/pages/HackathonDetail.tsx
  - frontend/e2e/hackathon-participants-empty-state.spec.ts (new)
  - PRD.md
- Learnings for future iterations:
  - Empty state components should follow consistent patterns: icon in circular bg, heading, subtext, optional CTA
  - Conditional CTAs should check multiple conditions: feature state (registration open), user state (not registered), and callback availability
  - E2E tests require the backend to be running - use TypeScript build check for quick validation
  - ParticipantsSection now properly integrates with the existing RegisterModal flow via onRegisterClick callback
  - The empty state styling uses flex-col, items-center, text-center, and space-y-4 for consistent spacing
  - Icon containers use rounded-full with bg-muted/50 and appropriate padding for visual consistency
---

