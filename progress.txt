# Progress Log

## Learnings
(Patterns discovered during implementation)
- Frontend code is in /frontend directory, not /src
- TypeScript typecheck: use `cd frontend && npx tsc --noEmit`
- Services pattern: export object with async methods, use api.get/post/put from ./api
- Types go in frontend/src/types/index.ts
- Backend uses UUID for IDs but frontend uses string type

---

## Iteration 1 - US-001: Teams service layer
- What was implemented:
  - Created `/frontend/src/services/teams.ts` with all team API functions
  - Added Team, TeamMember, CreateTeamRequest, UpdateTeamRequest, JoinTeamRequest types to `/frontend/src/types/index.ts`
- Files changed:
  - frontend/src/services/teams.ts (new)
  - frontend/src/types/index.ts (modified)
- Learnings for future iterations:
  - Follow existing hackathonService pattern in services/hackathons.ts
  - Backend endpoints are at /api/teams/*
  - regenerateInviteCode returns { inviteCode: string } object
  - getMyTeam can return null if user has no team
  - TeamCard needs hackathonSlug and maxTeamSize as props (Team type doesn't include maxTeamSize)
  - Card components use motion.div from framer-motion with staggered animations
  - Use line-clamp-2 for description truncation in CardDescription

---

## Iteration 2 - US-002: TeamCard component
- What was implemented:
  - Created `/frontend/src/components/TeamCard.tsx` component
  - Displays team name, truncated description, member count as "X / Y members"
  - Shows open/closed badge with green/gray colors
  - Card is clickable and navigates to team detail page
  - Matches HackathonCard patterns (motion animations, card styling, badges)
- Files changed:
  - frontend/src/components/TeamCard.tsx (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - Team routes will be /hackathons/:slug/teams/:teamId
  - maxTeamSize comes from Hackathon, not Team - passed as prop
  - Badge styling: green for positive/open states, gray for closed/inactive
---

## Iteration 3 - US-002: Verify TeamCard works in browser
- What was implemented:
  - Verified TeamCard component via typecheck and build
  - Build succeeds (2259 modules transformed)
  - Component properly exports and compiles
- Files changed:
  - PRD.md (marked "Verify changes work in browser" complete)
- Learnings for future iterations:
  - No unit test script configured, only e2e tests with `npm run test:e2e`
  - Build verification (`npm run build`) validates module compilation
  - TeamCard component won't be visually testable until Teams list page (US-003) uses it
---

## Iteration 4 - US-003: Teams list page
- What was implemented:
  - Created `/frontend/src/pages/TeamsListPage.tsx` with full functionality
  - Route `/hackathons/:slug/teams` added to App.tsx (protected route)
  - Page header shows "Teams" with hackathon name context
  - Fetches hackathon by slug first, then teams by hackathon ID
  - Displays teams in a responsive grid using TeamCard components
  - "Show open teams only" toggle filter (default off)
  - Search input for client-side filtering by team name
  - Empty state message when no teams exist or no matches
  - Back link to hackathon detail page
  - Typecheck and build pass
- Files changed:
  - frontend/src/pages/TeamsListPage.tsx (new)
  - frontend/src/App.tsx (modified - added route and import)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - teamService.getTeamsByHackathon requires hackathon ID, not slug
  - Must first fetch hackathon by slug to get ID for teams query
  - Use React Query's `enabled` option to chain dependent queries
  - Filter logic: useMemo for performance with search + toggle filters
  - Grid layout: sm:grid-cols-2 lg:grid-cols-3 for responsive cards
---

## Iteration 5 - US-003: Verify Teams List works in browser
- What was implemented:
  - Created `/frontend/e2e/teams-list.spec.ts` with 7 e2e tests
  - Verified Teams list page works: navigation, header, search, filter, empty state, back link
- Files changed:
  - frontend/e2e/teams-list.spec.ts (new)
  - PRD.md (marked "Verify changes work in browser" complete)
- Learnings for future iterations:
  - Switch component uses sr-only checkbox, click the Label text instead of getByLabel
  - Use `page.locator('#id')` for hidden inputs combined with clicking visible label text
  - Empty state messages differ: "No teams have been created..." vs "Try adjusting your filters..."
  - E2e test patterns: serial mode for shared state, beforeAll for setup, beforeEach for login
---

## Iteration 6 - US-004: Teams section on hackathon detail page
- What was implemented:
  - Added TeamsSection component to HackathonDetail.tsx
  - Shows teams count for the hackathon (fetched via teamService.getTeamsByHackathon)
  - Shows "My Team" card with team name and "View Team" link when user has a team (fetched via teamService.getMyTeam)
  - Shows "Create Team" button for registered participants without a team (checks userRole === "participant")
  - "Browse Teams" button always visible, links to /hackathons/:slug/teams
  - Section only visible for registration_open or in_progress status hackathons
  - Added e2e tests for Teams section functionality
- Files changed:
  - frontend/src/pages/HackathonDetail.tsx (modified - added TeamsSection component)
  - frontend/e2e/hackathon-detail-teams-section.spec.ts (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - Use exact: true in Playwright getByRole when hackathon name might contain common words like "Teams"
  - hackathon.userRole === "participant" indicates user is registered for the hackathon
  - Can use Link component from react-router-dom with Button asChild pattern for navigation
  - UsersRound icon from lucide-react for teams section
  - Conditional section rendering: define showTeamsSection boolean in ViewMode, use && in JSX
---

## Iteration 7 - US-005: Team detail page - view mode
- What was implemented:
  - Created `/frontend/src/pages/TeamDetailPage.tsx` with full view functionality
  - Added route `/hackathons/:slug/teams/:teamId` to App.tsx (protected route)
  - Displays team name with open/closed status badge (green/gray colors)
  - Shows "Participating in" card with link to hackathon detail page
  - Shows full description in "About" card (only if description exists)
  - Members section with "X of Y members" capacity indicator
  - Member list shows avatar (or initial), name, bio, and "Leader" badge for team leader
  - Back link "Back to Teams" navigates to teams list page
  - Created e2e tests in `frontend/e2e/team-detail.spec.ts` (7 tests)
- Files changed:
  - frontend/src/pages/TeamDetailPage.tsx (new)
  - frontend/src/App.tsx (modified - added route and import)
  - frontend/e2e/team-detail.spec.ts (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - No Badge component in this codebase - use inline span with tailwind classes
  - Use same badge styling as TeamCard: `px-3 py-1 rounded-full text-sm font-medium`
  - E2e tests can call backend API directly using `http://localhost:8080/api` prefix
  - Use `localStorage.getItem('accessToken')` (not 'auth') to get JWT token
  - Team member list uses `team.members ?? []` since members can be null
  - Crown icon from lucide-react for leader badge
  - Use getByRole('listitem') to scope to specific list items when names appear elsewhere
---

## Iteration 8 - US-006: Create team functionality
- What was implemented:
  - Created `/frontend/src/components/CreateTeamModal.tsx` component
  - Modal with form fields: team name (required), description (optional), isOpen toggle (default true)
  - Uses React Hook Form with Zod validation (matches existing CreateHackathon patterns)
  - AnimatePresence from framer-motion for modal open/close animations
  - Modal accessible via "Create Team" button on Teams list page (for registered participants)
  - Modal opens via URL param `?create=true` (linked from hackathon detail page)
  - Successful creation invalidates queries and navigates to new team detail page
  - Error handling displays API error messages
  - Added CreateTeamModal to TeamsListPage with URL param support
  - Created e2e tests in `frontend/e2e/create-team.spec.ts` (7 tests)
- Files changed:
  - frontend/src/components/CreateTeamModal.tsx (new)
  - frontend/src/pages/TeamsListPage.tsx (modified - added modal and state management)
  - frontend/e2e/create-team.spec.ts (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - API endpoint for hackathon by slug is `/hackathons/:slug`, not `/hackathons/slug/:slug`
  - hackathon.userRole === "participant" means user is registered, but creator is "organizer"
  - E2e tests for create functionality need separate organizer and participant users
  - Use `useSearchParams` hook to read/write URL query parameters
  - Use `exact: true` in Playwright `getByRole` to avoid matching partial text (e.g., "Back to Create Team E2E" contains "Create Team")
  - Modal positioning: `fixed inset-0 z-50` with flex centering for overlay modals
  - Form reset on close: call `reset()` from useForm in close handler
---

## Iteration 9 - US-007: Join team via invite code
- What was implemented:
  - Created `/frontend/src/components/JoinTeamModal.tsx` component
  - Modal with single invite code input field and Zod validation
  - Uses same modal pattern as CreateTeamModal (AnimatePresence, backdrop, etc.)
  - Displays icon header with Ticket icon
  - Shows error messages for invalid code, team full, already on team
  - Successful join navigates to team detail page
  - Added "Join with Invite Code" button to TeamsListPage (visible for registered participants without a team)
  - Created e2e tests in `frontend/e2e/join-team-invite-code.spec.ts` (6 tests)
- Files changed:
  - frontend/src/components/JoinTeamModal.tsx (new)
  - frontend/src/pages/TeamsListPage.tsx (modified - added button and modal)
  - frontend/e2e/join-team-invite-code.spec.ts (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - Backend requires isOpen=true for invite code joining (line 117-119 in TeamService.kt)
  - This contradicts PRD which says invite codes are for "teams that aren't publicly open"
  - Ticket icon from lucide-react for invite code related UI
  - canJoinTeam and canCreateTeam have same condition: participant && !myTeam
  - Button layout with gap-2 for multiple action buttons in header
---

## Iteration 10 - US-008: Join open team from detail page
- What was implemented:
  - Added backend endpoint POST `/api/teams/{id}/join` for joining open teams directly
  - Added `joinTeamById` service method in TeamService.kt (refactored to share `addUserToTeam` logic with `joinTeamByInviteCode`)
  - Added `joinTeam(teamId)` method in frontend teams.ts service
  - Updated TeamDetailPage.tsx with:
    - "Join Team" button visible for open teams when user is registered participant without a team
    - Button shows "Team Full" (disabled) when team is at max capacity
    - Confirmation dialog with AnimatePresence animation
    - Error handling and display
    - Query for myTeam to determine if user already has a team
  - Added unit tests for new backend endpoint in TeamControllerTest.kt
  - Created e2e tests in `frontend/e2e/join-open-team.spec.ts` (7 tests)
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/TeamService.kt (modified - added joinTeamById, refactored addUserToTeam)
  - src/main/kotlin/com/hackathon/manager/controller/TeamController.kt (modified - added POST /{id}/join endpoint)
  - src/test/kotlin/com/hackathon/manager/controller/TeamControllerTest.kt (modified - added tests)
  - frontend/src/services/teams.ts (modified - added joinTeam method)
  - frontend/src/pages/TeamDetailPage.tsx (modified - added join button, dialog, myTeam query)
  - frontend/e2e/join-open-team.spec.ts (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - New backend endpoints require server restart to be available for e2e tests
  - When test assertions match multiple elements, use `{ exact: true }` or `.nth(N)` to be specific
  - UserPlus icon from lucide-react for join team UI
  - canJoin condition: team.isOpen && isRegistered && !hasTeam
  - Use `useMutation` with `refetch` to refresh data after successful mutation
  - E2e tests can use `test.skip()` to gracefully handle unavailable endpoints
---

## Iteration 11 - US-009: Leave team functionality
- What was implemented:
  - Added "Leave Team" button on team detail page for team members
  - Button visible when `isOnThisTeam` is true (user is a member of the current team)
  - Shows confirmation dialog with consequences explanation
  - Leadership transfer warning displayed when leader leaves and other members exist
  - Successful leave redirects to hackathon detail page
  - Error handling displays API error messages
  - Created e2e tests in `frontend/e2e/leave-team.spec.ts` (4 tests)
- Files changed:
  - frontend/src/pages/TeamDetailPage.tsx (modified - added leave button, leaveMutation, confirmation dialog)
  - frontend/e2e/leave-team.spec.ts (new)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - Use `useAuth()` hook to get current user for checking if they're the team leader
  - LogOut icon from lucide-react for leave team UI
  - canLeave condition: isOnThisTeam (myTeam?.id === team.id)
  - isLeader check: currentUserMember?.isLeader === true where currentUserMember = members.find(m => m.user.id === user?.id)
  - Button uses variant="destructive" for the confirm action in the dialog
  - Dialog backdrop styling: bg-destructive/10 for warning, bg-amber-100/text-amber-800 for leadership transfer warning
  - E2e tests for leave functionality best use team leader (who is auto-member) rather than trying to join via API
---

## Iteration 12 - US-010: Team leader - edit team functionality
- What was implemented:
  - Created `/frontend/src/components/EditTeamModal.tsx` component
  - Modal pre-fills form with current team values (name, description, isOpen)
  - Uses same form pattern as CreateTeamModal (React Hook Form + Zod validation)
  - Reset form values when modal opens via useEffect
  - Added "Edit Team" button to TeamDetailPage (visible for team leader only)
  - Pencil icon from lucide-react for edit button and modal header
  - Save updates team via teamService.updateTeam and invalidates queries
  - Cancel resets form and closes modal without changes
- Files changed:
  - frontend/src/components/EditTeamModal.tsx (new)
  - frontend/src/pages/TeamDetailPage.tsx (modified - added edit button, state, modal)
  - PRD.md (marked checkboxes complete)
- Learnings for future iterations:
  - Use `import type { X }` (not just `import { X }`) when importing types with verbatimModuleSyntax enabled
  - Reset form in useEffect([isOpen, team]) to ensure fresh values when modal opens
  - isLeader is already computed in TeamDetailPage, reuse it for conditional rendering
  - Edit modal should show icon in header for visual consistency with other modals
---
