# Progress Log

## Learnings
(Patterns discovered during implementation)

- Backend is Kotlin + Spring Boot in `src/main/kotlin/com/hackathon/manager/`
- Frontend is React + Vite in `frontend/`
- Typecheck: `./gradlew compileKotlin` for backend, `npx tsc --noEmit` for frontend
- Tests: `./gradlew test` for backend (JaCoCo 70% coverage required)
- Existing judging entities: JudgingCriteria, JudgeAssignment, Score
- Existing repositories: JudgingCriteriaRepository, JudgeAssignmentRepository, ScoreRepository
- Existing DTOs: JudgingCriteriaResponse, JudgeAssignmentResponse, ScoreResponse, SubmitScoreRequest, SubmitScoresRequest
- Judges identified by HackathonUser.role = "judge"
- Service classes use constructor injection for dependencies
- HackathonService.isUserOrganizer(hackathonId, userId) returns true for organizers or admins
- DTOs use jakarta.validation.constraints for validation annotations (@NotNull, @Min, @Max)
- JudgingCriteriaRepository.findByHackathonIdOrderByDisplayOrder already exists and returns ordered list

---

## Iteration 1 - US-001: Create JudgingService for criteria management
- What was implemented:
  - Created JudgingService class with dependency injection for repositories
  - Implemented getCriteriaByHackathon(hackathonId) returning list ordered by displayOrder
  - Implemented createCriteria(hackathonId, request, userId) with organizer validation
  - Implemented updateCriteria(criteriaId, request, userId) with organizer validation
  - Implemented deleteCriteria(criteriaId, userId) with organizer validation
  - Added CreateJudgingCriteriaRequest and UpdateJudgingCriteriaRequest DTOs to JudgingDtos.kt
- Files changed:
  - src/main/kotlin/com/hackathon/manager/dto/JudgingDtos.kt (added DTOs)
  - src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (created)
- Learnings for future iterations:
  - Service methods that modify data should include userId param for authorization
  - Use hackathonService.isUserOrganizer() for organizer-only operations
  - @Transactional(readOnly = true) for read-only methods, @Transactional for writes
---

## Iteration 2 - US-002: Create JudgingController for criteria endpoints
- What was implemented:
  - Created JudgingController with base path `/api/judging`
  - GET /api/judging/hackathons/{hackathonId}/criteria - list criteria (public)
  - POST /api/judging/hackathons/{hackathonId}/criteria - create criteria (organizer only)
  - PUT /api/judging/criteria/{criteriaId} - update criteria (organizer only)
  - DELETE /api/judging/criteria/{criteriaId} - delete criteria (organizer only)
- Files changed:
  - src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (created)
- Learnings for future iterations:
  - Controller uses @AuthenticationPrincipal UserPrincipal to get authenticated user
  - JudgingService methods handle authorization internally (no need to check in controller)
  - GET endpoint for list criteria is public (no auth required)
  - Use ResponseEntity.noContent().build() for DELETE returning 204
  - Use ResponseEntity.status(HttpStatus.CREATED).body() for POST returning 201
---

## Iteration 3 - US-003: Add judge management endpoints
- What was implemented:
  - Added AddJudgeRequest and JudgeInfoResponse DTOs to JudgingDtos.kt
  - Added judge management methods to JudgingService: getJudgesByHackathon, addJudge, removeJudge
  - Added judge management endpoints to JudgingController: GET/POST/DELETE /judges
  - Created JudgingServiceTest with comprehensive tests for criteria and judge management
- Files changed:
  - src/main/kotlin/com/hackathon/manager/dto/JudgingDtos.kt (added DTOs)
  - src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (added methods and dependencies)
  - src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (added endpoints)
  - src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (created)
- Learnings for future iterations:
  - HackathonUserRepository.findByHackathonIdAndRole returns list of HackathonUser by role
  - ProjectRepository.findByHackathonIdAndStatus returns projects by status (use SubmissionStatus.submitted for submitted projects)
  - JudgeAssignmentRepository.findByJudgeIdAndHackathonId returns judge assignments for a hackathon
  - HackathonStatus enum uses snake_case: in_progress (not "active")
  - Team entity requires createdBy parameter in constructor
  - When adding judge, check if HackathonUser exists first (update role vs create new)
---

## Iteration 4 - US-004: Add scoring endpoints for judges
- What was implemented:
  - Added scoring service methods to JudgingService: getAssignmentsByJudge, getAssignment, submitScores
  - Added scoring endpoints to JudgingController: GET /assignments, GET /assignments/{id}, POST /assignments/{id}/scores
  - Auto-create JudgeAssignment when judge first accesses their assignments list (lazy creation per project)
  - Mark assignment as completed when all criteria have been scored
  - Validate score is within 0 to criteria.maxScore
  - Added comprehensive tests for scoring functionality
- Files changed:
  - src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (added scoring methods and ScoreRepository dependency)
  - src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (added scoring endpoints)
  - src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (added scoring tests)
- Learnings for future iterations:
  - ScoreRepository.findByJudgeAssignmentIdAndCriteriaId returns existing score or null
  - ScoreRepository.findByJudgeAssignmentId returns all scores for an assignment
  - When saving new entities in tests, mock save() to return object with ID to avoid NPE in fromEntity methods
  - JudgeAssignmentResponse.fromEntity(assignment, includeScores=true) includes scores list
  - Judge authorization: check HackathonUser.role == UserRole.judge for hackathon access
  - Assignment authorization: check assignment.judge.id == userId for assignment access
  - Lazy user lookup: only fetch User entity when needed (e.g., when creating new assignments)
---

## Iteration 5 - US-005: Add leaderboard and results endpoints
- What was implemented:
  - Added LeaderboardEntryResponse and CriteriaAverageResponse DTOs to JudgingDtos.kt
  - Implemented getLeaderboard method in JudgingService with weighted average calculation
  - Added GET /api/judging/hackathons/{hackathonId}/leaderboard endpoint
  - Authorization: organizers can view anytime, participants only when hackathon status is "completed"
  - Weighted average calculation: sum(score * weight) / sum(weight) for each judge, then average across judges
  - Projects ranked by total score descending with rank assignment
- Files changed:
  - src/main/kotlin/com/hackathon/manager/dto/JudgingDtos.kt (added DTOs)
  - src/main/kotlin/com/hackathon/manager/service/JudgingService.kt (added getLeaderboard method)
  - src/main/kotlin/com/hackathon/manager/controller/JudgingController.kt (added leaderboard endpoint)
  - src/test/kotlin/com/hackathon/manager/service/JudgingServiceTest.kt (added leaderboard tests)
- Learnings for future iterations:
  - HackathonStatus enum: completed for finished hackathons
  - JudgeAssignmentRepository.findByProjectId returns all judge assignments for a project
  - Use BigDecimal.toDouble() to convert weights for calculation
  - Private data class can be defined inside service class for intermediate calculations
---

## Iteration 6 - US-006: Create frontend judging types and API service
- What was implemented:
  - Added judging types to frontend/src/types/index.ts: JudgingCriteria, JudgeAssignment, Score, JudgeInfo, LeaderboardEntry, CriteriaAverage
  - Added request types: CreateJudgingCriteriaRequest, UpdateJudgingCriteriaRequest, SubmitScoreRequest, SubmitScoresRequest, AddJudgeRequest
  - Created frontend/src/services/judging.ts with all API methods
  - Methods: getCriteria, createCriteria, updateCriteria, deleteCriteria
  - Methods: getJudges, addJudge, removeJudge
  - Methods: getMyAssignments, getAssignment, submitScores
  - Methods: getLeaderboard
- Files changed:
  - frontend/src/types/index.ts (added judging types)
  - frontend/src/services/judging.ts (created)
  - PRD.md (marked US-006 complete)
- Learnings for future iterations:
  - Frontend services follow pattern: export const service = { async method(): Promise<Type> {...} }
  - Services import api from "./api" and use api.get/post/put/delete
  - Backend BigDecimal maps to number in TypeScript
  - Backend UUID maps to string in TypeScript
  - Backend OffsetDateTime maps to string in TypeScript
  - Frontend typecheck: npx tsc --noEmit in frontend directory
---

## Iteration 7 - US-007: Create judging criteria management UI
- What was implemented:
  - Created CriteriaFormModal component for adding/editing judging criteria
  - Created DeleteCriteriaModal component for confirming criteria deletion
  - Created JudgingCriteriaSection component displaying list of criteria with add/edit/delete functionality
  - Integrated JudgingCriteriaSection into HackathonDetail page (visible to organizers only)
  - Criteria list displays name, description, max score, and weight
  - Add button opens form modal with fields for name, description, maxScore, weight, displayOrder
  - Edit button opens form modal with pre-filled values
  - Delete button shows confirmation dialog with warning about deleting associated scores
- Files changed:
  - frontend/src/components/CriteriaFormModal.tsx (created)
  - frontend/src/components/DeleteCriteriaModal.tsx (created)
  - frontend/src/components/JudgingCriteriaSection.tsx (created)
  - frontend/src/pages/HackathonDetail.tsx (added import and section)
  - PRD.md (marked US-007 criteria complete except browser verification)
- Learnings for future iterations:
  - Modal components follow pattern: AnimatePresence wrapping backdrop + modal divs
  - Use useForm with zodResolver for form validation
  - Use useQuery for fetching data, useMutation for create/update/delete
  - Pass isOrganizer prop to ViewMode to conditionally render organizer-only sections
  - Query keys should be descriptive: ["judging-criteria", hackathonId]
  - Card component with CardHeader/CardContent is the standard section container
---

## Iteration 8 - US-008: Create judge management UI
- What was implemented:
  - Created JudgesSection component displaying list of judges with name, email, and scoring progress
  - Created AddJudgeModal component with email search functionality
  - Created RemoveJudgeModal component with confirmation dialog
  - Added GET /api/users/by-email endpoint to UserController for user lookup by email
  - Created frontend/src/services/users.ts for user lookup service
  - Integrated JudgesSection into HackathonDetail page (visible to organizers only)
  - Shows empty state when no judges assigned
  - Each judge row shows scoring progress as X of Y projects scored with percentage
- Files changed:
  - src/main/kotlin/com/hackathon/manager/controller/UserController.kt (added by-email endpoint)
  - frontend/src/services/users.ts (created)
  - frontend/src/components/JudgesSection.tsx (created)
  - frontend/src/components/AddJudgeModal.tsx (created)
  - frontend/src/components/RemoveJudgeModal.tsx (created)
  - frontend/src/pages/HackathonDetail.tsx (added JudgesSection import and integration)
  - PRD.md (marked US-008 complete)
- Learnings for future iterations:
  - UserService.getUserByEmail already exists in backend - just needed endpoint
  - Use encodeURIComponent for query parameters in frontend API calls
  - Query keys for judges: ["judges", hackathonId]
  - Modal search pattern: search form + found result display + action button
  - Gavel icon from lucide-react is good for judge-related UI
---
